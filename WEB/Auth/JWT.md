# 🗝 JWT
<div align="center">
    <img src="./img/cover.png">
</div>

### 1️⃣ JWT 개념
> **Json Web Token**의 약자로,
> Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 [Claim](../../ETC/ETC.md#Claim이란?) 기반의 Web Token이다.

일반적으로 클라이언트와 서버, 서비스와 서비스 사이 통신 시 권한 인가(Authorization)를 위해 사용하는 토큰을 뜻합니다.

<br>

### 2️⃣ JWT 등장배경
일반적인 인증 로직을 보도록 합시다.
<div align="center">
    <img src="./img/t_1.png">
</div>
<br>

사용자가 ID, PW를 입력하고, 그 데이터가 서버로 전송이 됩니다.<br>
서버에서는 전송받은 ID, PW를 **DB**에 조회하고 회원이면 로그인을 시켜줍니다.<br><br>

그런데 문제는 여기서 생기게됩니다.<br>
HTTP는 **Stateless**, 즉 사용자가 새로운 요청을 한다면 과거에 로그인한 사실을 기억하지 못합니다.<br>

> `여기서 잠깐!`
[HTTP에 대해서 궁금하다면?🤔](../../Internet/HTTP//http.md)

이 문제를 해결하기 위해서 예전에는 로그인 할 때 DB에 누가 로그인했는지 기록해야 했습니다.<br><br>

그래서 나온게 쿠키와 세션이였는데, 쿠키와 세션에는 각각 문제점들이 있었습니다.<br>

`이 글은 JWT와 관련된 정보만 있는 공간이기 때문에, 쿠키와 세션에 대해서는 다른 글에 적도록 하겠습니다.`
[쿠키와 세션을 아시나요?](../../Internet/Cookie/cookie.md)

그리고 이를 보완하기 위해서 토큰 기반의 인증방식을 사용하는 추세인데요.<br>
토큰 기반 인증방식의 로직은 이렇습니다.
<div align="center">
    <img src="./img/t_2.png">
</div>
<br>

로그인을 하면 로그인한 사용자를 위한 토큰을 발급합니다.<br><br>
사용자는 이 토큰을 가지고 물건 구입, 구입 내역 조회와 같이 계정 정보가 필요한 요청을 할 때 이 **토큰과 함께 요청**합니다.<br>
토큰에는 요청한 사람의 정보가 담겨있기에 서버는 DB를 조회하지 않고 누가 요청하는지 알 수 있고, 별도의 인증 서버가 필요 없게됩니다.<br><br>

그리고 토큰은 서버의 상태를 저장하지 않습니다.<br>
따라서 요청을 받을 서버 자체에서 인증 프로세스를 수행할 수 있게 되죠.<br><br>

또한, JSON 포맷으로 통신하기 때문에 어떤 Client에서든 Data 통신에 JSON을 이용하면 Token을 이용할 수 있습니다.

---
    애플리케이션이 실행될 때, JWT를 static 변수와 로컬 스토리지에 저장하게 된다.
    static 변수에 저장되는 이유는 HTTP 통신을 할 때마다 JWT를 HTTP 헤더에 담아서 보내야 하는데, 이를 로컬 스토리지에서 계속 불러오면 오버헤드가 발생하기 때문이다.

    클라이언트에서 JWT를 포함해 요청을 보내면 서버는 허가된 JWT인지를 검사한다.

    또한 로그아웃을 할 경우 로컬 스토리지에 저장된 JWT 데이터를 제거한다.
    (실제 서비스의 경우에는 로그아웃 시, 사용했던 토큰을 blacklist라는 DB 테이블에 넣어 해당 토큰의 접근을 막는 작업을 해주어야 한다.)

### 3️⃣ JWT 구조
<div align="center">
    <img src="./img/jwt.png">
</div>

> JWT는 ***Header, Payload, Signature***의 3 부분으로 이루어지며, Json 형태인 각 부분은 **Base64**로 [인코딩](../ETC/ETC.md#인코딩이란?) 되어 표현된다.
#### 📍 HEADER(헤더)
- 헤더(Header)는 JWT를 어떻게 **검증**(Verify)하는가에 대한 내용을 담고 있다.
- **typ, alg** 두 가지 정보로 구성됩니다.
```json
{
  "alg": "HS256"
  "typ": "JWT",
}
```
#### 📍 PAYLOAD(내용)
#### 📍 Signature(서명)